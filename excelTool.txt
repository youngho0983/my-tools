import org.apache.poi.ss.usermodel.CellType;
import org.apache.poi.xssf.usermodel.XSSFCell;
import org.apache.poi.xssf.usermodel.XSSFRow;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.Scanner;

public class Retry {
public static void main(String[] args) throws IOException {


Scanner s=new Scanner(System.in);
XSSFWorkbook workbook=null;
XSSFSheet sheet =null;
XSSFRow row=null;
XSSFCell cell=null;
String hwak=null;
String outputDir=null;
String excelFullName=null;
File excel=null;
FileInputStream excelFileInputStream=null;
String imgDirPath;
int rowNum;
int cellNum;
int fileNameCol;
int dirNameCol;

System.out.println("엑셀로 파일 정리하기 프로그램 시작");

System.out.println("엑셀의 Full Name 입력(경로포함)");
excelFullName=s.nextLine();
System.out.println("이미지 파일들이 모여있는 디렉토리의 주소를 적어주세요");
imgDirPath=s.nextLine();

System.out.println("엑셀 몇 열이 파일 이름들을 지정하는 열입니까?");
fileNameCol =s.nextInt();
System.out.println("엘셀 몇 열이 정리될 폴더를 지정하는 열입니까?");
dirNameCol=s.nextInt();
System.out.println("확장자명을 입력해주세요");
hwak=s.nextLine();
hwak=s.nextLine();
System.out.println("파일 명 :"+excelFullName);
System.out.println("파일 이름 지정 열: "+fileNameCol);
System.out.println("폴더 지정 열"+dirNameCol);
System.out.println("이미지들이 모여있는 디렉터리 " +imgDirPath);
System.out.println("확장자 명은"+hwak);



excel=new File(excelFullName);
if(excel.exists()){

try{
excelFileInputStream =new FileInputStream(excel);
workbook=new XSSFWorkbook(excelFileInputStream);
sheet=workbook.getSheetAt(0);
rowNum=sheet.getPhysicalNumberOfRows();


for(int i=0;i<rowNum;i++){
row=sheet.getRow(i);
cellNum=row.getPhysicalNumberOfCells();
String wantMakeDirName="";
File wantCopyfile=null;
String wantCopyFileName="";
String wantOutputFileName="";

for(int j=0;j<cellNum;j++){
if((j+1)!= dirNameCol){
if((j+1)!=fileNameCol){

cell=row.getCell(j);
if(cell.getCellType()== CellType.STRING){
System.out.print(cell.getStringCellValue() +"|");
}
if(cell.getCellType()==CellType.NUMERIC){
System.out.print(cell.getNumericCellValue()+"|");

}

System.out.println("");


}

}
if((j+1)==dirNameCol){
File wantMakeDir=null;
cell=row.getCell(j);
if(cell.getCellType()== CellType.STRING){
System.out.print(cell.getStringCellValue() +"디렉터리 생성|");
wantMakeDir=new File( imgDirPath+File.separator+"resultWhatYouWant"+File.separator+cell.getStringCellValue());
wantMakeDirName=imgDirPath+File.separator+"resultWhatYouWant"+File.separator+cell.getStringCellValue();
if(cell.getStringCellValue().equals("")){
continue;
}
}
if(cell.getCellType()==CellType.NUMERIC){
System.out.print(cell.getNumericCellValue()+"디렉터리 생성|");

wantMakeDir=new File( imgDirPath+File.separator+"resultWhatYouWant"+File.separator+cell.getNumericCellValue());
wantMakeDirName=imgDirPath+File.separator+"resultWhatYouWant"+File.separator+cell.getNumericCellValue();
}
if(wantMakeDir.exists()!=true) {


wantMakeDir.mkdirs();
}
}

if((j+1)==fileNameCol){
File wantMakeDir=null;
cell=row.getCell(j);
if(cell.getCellType()== CellType.STRING){
System.out.print(cell.getStringCellValue() +"파일 생성|");
wantCopyfile=new File( imgDirPath+File.separator+cell.getStringCellValue()+"."+hwak);
wantCopyFileName=cell.getStringCellValue()+"."+hwak;
if(cell.getStringCellValue().equals("")){
continue;
}
}
if(cell.getCellType()==CellType.NUMERIC){
System.out.print(cell.getNumericCellValue()+"파일 생성|");

wantCopyfile=new File( imgDirPath+File.separator+cell.getNumericCellValue()+"."+hwak);
wantCopyFileName=cell.getNumericCellValue()+"."+hwak;
}


}




}

int leng=0;
byte arr[]=new byte[1024];
FileInputStream fis=null;
FileOutputStream fos=null;
try{


if(wantCopyfile!=null){
if(wantCopyfile.exists()){


fis=new FileInputStream(wantCopyfile);
fos=new FileOutputStream(wantMakeDirName+File.separator+wantCopyFileName+"."+hwak);

while( (leng=fis.read(arr))!=-1 ){
fos.write(arr,0,leng);
}
}
}
}catch (Exception e){
e.printStackTrace();
}finally {
if(fis!=null){

fis.close();
}
if(fos!=null){

fos.close();

}
}

}

}catch (Exception e){
e.printStackTrace();
}finally {
excelFileInputStream.close();
}

}




}
}
